#Brachyspira hyodysenteriae bioinformatic workflow

This repository contains the bioinformatics workflow and custom scripts used in the study:  
**"Genomic insights into the population structure, antimicrobial resistance, and virulence of Brachyspira hyodysenteriae from diverse geographical regions."**

## Project Overview 
-Organism: Brachyspira hyodysenteriae 
- Number of genomes analyzed: 251
- Bioinformatic tools used: FastQC, MultiQC, Trimmomatic (V0.39), SPAdes (V3.15.5), Prokka (v1.14.6), Panaroo (v1.3.4), SNP-sites (v2.5.1), IQ-TREE (v2.1.4), Newick Utilities (v1.6), Fastbaps (v1.0.8), and eggnog-mapper (v2.1.12)

Genomic data have been deposited to GenBank under Bioproject accession (GenBank accession no. PRJNA1228138). 

FastQC (Quality Control of Raw Reads)
FastQC v0.11.9 was used to assess the quality of raw paired-end reads.
fastqc *.fastq.gz
# This was run in a loop across all FASTQ files within a high-performance computing environment.

üìä MultiQC (Aggregated Quality Reports)
MultiQC v1.12 was used to summarize FastQC reports.
multiqc .

#üí°Notes: MultiQC was run in the directory containing the FastQC output files.

Trimmomatic Parameters Used
Paired-end reads were trimmed using Trimmomatic v0.39 with the following options:
trimmomatic PE -threads 8 input_R1.fastq.gz input_R2.fastq.gz \
  trimmed_R1.fastq.gz R1_unpaired.fastq.gz \
  trimmed_R2.fastq.gz R2_unpaired.fastq.gz \
  ILLUMINACLIP:NexteraPE-PE.fa:2:30:10:8:true \
  LEADING:3 TRAILING:3 SLIDINGWINDOW:4:20 MINLEN:36
  
#NOTE: üí° We used NexteraPE-PE.fa for adapter trimming. Adapter sequences may vary depending on the library preparation method ‚Äî users should confirm which adapter file is appropriate for their dataset.

üß¨ SPAdes (Genome Assembly)
SPAdes v3.15.5 was used for de novo genome assembly of paired-end reads.
spades.py --careful \
  -1 trimmed_R1.fastq.gz \
  -2 trimmed_R2.fastq.gz \
  -o sampleID_spades_output
  
#Note: üí° Assemblies were generated using the --careful option to reduce mismatches and short indels. Assemblies were run individually for each sample using a loop over paired-end read files.
Output directories were named per sample and collected in a folder called Spade-done/.
<details> <summary>üîÅ Sample SLURM batch script used for SPAdes loop</summary>
for f1 in *_R1_001.fastq.gz; do
    base=${f1%_R1_001.fastq.gz}
    f2=${base}_R2_001.fastq.gz

    spades.py --careful -1 ${f1} -2 ${f2} -o ${base}_spades_output
    cp -r ${base}_spades_output Spade-done/
done
</details>

üß¨ Prokka (Genome Annotation)
Prokka v1.14.6 was used to annotate the genomic assemblies of all 251 Brachyspira hyodysenteriae genomes.
prokka --outdir sample_output_dir \
  --force \
  --kingdom Bacteria \
  --genus Brachyspira \
  --prefix annotated_ \
  sample.fasta
  
#üí° Note: All genomes were annotated in a loop using the above parameters. Genus was specified as Brachyspira and default bacterial settings were used.

üß¨ Panaroo (Pangenome Analysis)
Panaroo v1.3.4 was used to perform pangenome analysis and generate a core gene alignment from annotated genomes
panaroo -i ./annotated_assemblies_gff_files/*.gff \
  -o ./panaroo_output/ \
  --clean-mode strict \
  -a core \
  --aligner mafft \
  --core_threshold 0.95 \
  -t 10
  
#üí° Note:
The input files (*.gff) were generated from Prokka annotations.
We used --clean-mode strict to reduce spurious gene predictions.
MAFFT was used as the aligner, and a 95% presence threshold (--core_threshold 0.95) defined the core genome

üß¨ SNP-sites (SNP Extraction from Core Genome Alignment)
SNP-sites v2.5.1 was used to extract single nucleotide polymorphisms (SNPs) from the core gene alignment produced by Panaroo.
snp-sites -mvph -o snp-filtered_core_gene_alignment.aln core_gene_alignment.aln

#üí° Note:
core_gene_alignment.aln was the core genome alignment generated by Panaroo.
The flags -mvph were used to:
-m: output in multi-FASTA format
-v: produce variant sites only
-p: output in PHYLIP format (used in downstream tools)
-h: add a header line
The resulting alignment (snp-filtered_core_gene_alignment.aln) was used for downstream phylogenetic inference with IQ-TREE.

üå≥ IQ-TREE (Phylogenetic Tree Construction)
IQ-TREE v2.1.4 was used to construct a maximum likelihood phylogenetic tree based on SNPs from the core genome alignment.

bash:
iqtree -s snp-filtered_core_gene_alignment.aln.snp_sites.aln -m MFP -nt AUTO

#üí° Notes:
The input file snp-filtered_core_gene_alignment.aln.snp_sites.aln was generated by SNP-sites.
The -m MFP option invokes ModelFinder Plus, which automatically selects the best-fit substitution model.

üß© Newick Utilities (Midpoint Rooting)
Newick Utilities v1.6 was used to midpoint root the phylogenetic tree generated by IQ-TREE.
nw_reroot snp-filtered_core_gene_alignment.aln.snp_sites.aln.treefile > rooted_tree.nwk

#üí° Notes:
nw_reroot was used to apply midpoint rooting to the tree.
The resulting output file (rooted_tree.nwk) was used for downstream lineage classification and tree annotation.

üß¨ FastBAPS (Lineage Classification)
FastBAPS v1.0.8 was used for Bayesian hierarchical clustering of the SNP alignment to infer population structure.
run_fastbaps \
  -i snp-filtered_core_gene_alignment.aln.snp_sites.aln \
  --phylogeny rooted_tree.nwk \
  -o snp-filtered_core_gene_alignment.aln.snp_sites.aln.baps \
  -p baps \
  -t 8
  
#üí° Notes:
The input was the SNP alignment generated from snp-sites, and the midpoint-rooted tree obtained using Newick Utilities.
The baps option was used to enable hierarchical Bayesian clustering directly on the phylogeny.
This SNP-based approach was selected to provide high-resolution strain differentiation and to account for potential overrepresentation of closely related isolates, particularly those from the same BioProject in NCBI.
